sequenceDiagram
    autonumber
    participant C as Client
    participant GW as API Gateway (Nginx)
    participant US as User Service (Symfony)
    participant MQ as RabbitMQ
    participant NW as Notification Worker (Node.js)
    participant NS as Notification Service (Express)
    participant NDB as Notifications DB (MySQL)

    Note over C,GW: Synchronous REST via Gateway

    C->>GW: POST /api/v1/users (create user)
    GW->>US: POST /users (proxy)
    US-->>GW: 201 Created + User
    GW-->>C: 201 Created + User

    Note over US,MQ: Asynchronous event publication

    US-->>MQ: publish "user.created" event

    Note over MQ,NW: Worker consumes events

    MQ-->>NW: user.created
    NW->>NS: POST /notifications (create message)
    NS->>NDB: INSERT notification
    NDB-->>NS: OK
    NS-->>NW: 201 Created

    Note over C,GW: Client fetches notifications later

    C->>GW: GET /api/v1/notifications?userId=...
    GW->>NS: GET /notifications?userId=...
    NS->>NDB: SELECT notifications
    NDB-->>NS: Rows
    NS-->>GW: 200 OK + List
    GW-->>C: 200 OK + List
